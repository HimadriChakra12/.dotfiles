#!/bin/bash

# Enhanced Rofi script for i3-timer
# Features: Presets, custom time, start/stop controls

# Configuration
TIMER_BIN="$HOME/.dotfiles/i3/scripts/i3blocks/timer"  # Change this to the full path of your i3-timer binary
ROFI_THEME=""           # Add your rofi theme here if you want (e.g., -theme ~/.config/rofi/timer.rasi)

# Function to set timer with error handling
set_timer() {
    local duration="$1"
    local label="$2"
    
    if $TIMER_BIN --set "$duration" 2>/dev/null; then
        notify-send "â±ï¸ Timer" "Set to $label" -t 2000
        return 0
    else
        notify-send "âŒ Timer Error" "Failed to set timer" -u critical -t 3000
        return 1
    fi
}

# Build the menu
menu=$(cat <<EOF
â–¶ï¸  Start timer
â¹ï¸  Stop timer
â±ï¸  5 seconds
â±ï¸  10 seconds
â±ï¸  30 seconds
â±ï¸  1 minute
â±ï¸  2 minutes
â±ï¸  5 minutes
â±ï¸  10 minutes
â±ï¸  15 minutes
â±ï¸  20 minutes
ğŸ…  25 minutes (Pomodoro)
â±ï¸  30 minutes
â±ï¸  45 minutes
ğŸ•  1 hour
ğŸ•  1 hour 30 minutes
ğŸ•  2 hours
ğŸ•  3 hours
âŒ¨ï¸  Custom time...
EOF
)

# Show menu
selected=$(echo "$menu" | rofi -dmenu -i -p "â²ï¸ Timer" \
    -theme-str 'window {width: 450px;}' \
    -theme-str 'listview {lines: 20;}' \
    $ROFI_THEME)

# Exit if cancelled
[[ -z "$selected" ]] && exit 0

# Handle selection
case "$selected" in
    "â±ï¸  5 seconds")           set_timer "5s" "5 seconds" ;;
    "â±ï¸  10 seconds")          set_timer "10s" "10 seconds" ;;
    "â±ï¸  30 seconds")          set_timer "30s" "30 seconds" ;;
    "â±ï¸  1 minute")            set_timer "1m" "1 minute" ;;
    "â±ï¸  2 minutes")           set_timer "2m" "2 minutes" ;;
    "â±ï¸  5 minutes")           set_timer "5m" "5 minutes" ;;
    "â±ï¸  10 minutes")          set_timer "10m" "10 minutes" ;;
    "â±ï¸  15 minutes")          set_timer "15m" "15 minutes" ;;
    "â±ï¸  20 minutes")          set_timer "20m" "20 minutes" ;;
    "ğŸ…  25 minutes (Pomodoro)") set_timer "25m" "25 minutes (Pomodoro)" ;;
    "â±ï¸  30 minutes")          set_timer "30m" "30 minutes" ;;
    "â±ï¸  45 minutes")          set_timer "45m" "45 minutes" ;;
    "ğŸ•  1 hour")              set_timer "1h" "1 hour" ;;
    "ğŸ•  1 hour 30 minutes")   set_timer "1h30m" "1 hour 30 minutes" ;;
    "ğŸ•  2 hours")             set_timer "2h" "2 hours" ;;
    "ğŸ•  3 hours")             set_timer "3h" "3 hours" ;;
    
    "âŒ¨ï¸  Custom time...")
        custom=$(echo "" | rofi -dmenu -p "Enter time (e.g., 1h30m45s)" \
            -theme-str 'window {width: 450px;}' \
            -mesg "Examples: 1h30m, 90m, 45s, 2h15m30s" \
            $ROFI_THEME)
        
        if [[ -n "$custom" ]]; then
            if $TIMER_BIN --set "$custom" 2>/dev/null; then
                notify-send "â±ï¸ Timer" "Set to $custom" -t 2000
            else
                notify-send "âŒ Timer Error" "Invalid format: $custom" -u critical -t 3000
            fi
        fi
        ;;
    
    "â–¶ï¸  Start timer")
        $TIMER_BIN --exec-start 2>/dev/null
        notify-send "â–¶ï¸ Timer" "Started" -t 2000
        ;;
    
    "â¹ï¸  Stop timer")
        $TIMER_BIN --exec-stop 2>/dev/null
        notify-send "â¹ï¸ Timer" "Stopped and reset" -t 2000
        ;;
    
    "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
        # Separator selected, do nothing
        ;;
esac
