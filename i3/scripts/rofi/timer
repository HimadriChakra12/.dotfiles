#!/bin/bash
# Enhanced Rofi script for i3-timer
# Features: Presets, custom time, till specific time, start/stop controls

# Configuration
TIMER_BIN="$HOME/.dotfiles/i3/scripts/i3blocks/timer" # Change this to the full path of your i3-timer binary
ROFI_THEME=""                                         # Add your rofi theme here if you want (e.g., -theme ~/.config/rofi/timer.rasi)

# Function to set timer with error handling
set_timer() {
    local duration="$1"
    local label="$2"

    if $TIMER_BIN --set "$duration" 2>/dev/null; then
        notify-send "â±ï¸ Timer" "Set to $label" -t 2000
        return 0
    else
        notify-send "âŒ Timer Error" "Failed to set timer" -u critical -t 3000
        return 1
    fi
}

# Function to set timer till specific time
set_timer_till() {
    local time="$1"
    local label="$2"

    if $TIMER_BIN --till "$time" 2>/dev/null; then
        notify-send "â±ï¸ Timer" "Set until $label" -t 2000
        return 0
    else
        notify-send "âŒ Timer Error" "Failed to set timer" -u critical -t 3000
        return 1
    fi
}

# Build the menu
menu=$(
    cat <<EOF
â–¶ï¸  Start timer
â¹ï¸  Stop timer
â±ï¸  5 seconds
â±ï¸  10 seconds
â±ï¸  30 seconds
â±ï¸  1 minute
â±ï¸  2 minutes
â±ï¸  5 minutes
â±ï¸  10 minutes
â±ï¸  15 minutes
â±ï¸  20 minutes
ğŸ…  25 minutes (Pomodoro)
â±ï¸  30 minutes
â±ï¸  45 minutes
ğŸ•  1 hour
ğŸ•  1 hour 30 minutes
ğŸ•  2 hours
ğŸ•  3 hours
âŒ¨ï¸  Custom time...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ•  Till 00:00 (midnight)
ğŸ•  Till 01:00 (1 AM)
ğŸ•  Till 02:00 (2 AM)
ğŸ•  Till 03:00 (3 AM)
ğŸ•  Till 04:00 (4 AM)
ğŸ•  Till 05:00 (5 AM)
ğŸ•  Till 06:00 (6 AM)
ğŸ•  Till 07:00 (7 AM)
ğŸ•  Till 08:00 (8 AM)
ğŸ•  Till 09:00 (9 AM)
ğŸ•  Till 10:00 (10 AM)
ğŸ•  Till 11:00 (11 AM)
ğŸ•  Till 12:00 (noon)
ğŸ•  Till 13:00 (1 PM)
ğŸ•  Till 14:00 (2 PM)
ğŸ•  Till 15:00 (3 PM)
ğŸ•  Till 16:00 (4 PM)
ğŸ•  Till 17:00 (5 PM)
ğŸ•  Till 18:00 (6 PM)
ğŸ•  Till 19:00 (7 PM)
ğŸ•  Till 20:00 (8 PM)
ğŸ•  Till 21:00 (9 PM)
ğŸ•  Till 22:00 (10 PM)
ğŸ•  Till 23:00 (11 PM)
âŒ¨ï¸  Custom till time...
EOF
)

# Show menu
selected=$(echo "$menu" | rofi -dmenu -i -p "â²ï¸ Timer" \
    -theme-str 'window {width: 450px;}' \
    -theme-str 'listview {lines: 25;}' \
    $ROFI_THEME)

# Exit if cancelled
[[ -z "$selected" ]] && exit 0

# Handle selection
case "$selected" in
# Duration presets
"â±ï¸  5 seconds") set_timer "5s" "5 seconds" ;;
"â±ï¸  10 seconds") set_timer "10s" "10 seconds" ;;
"â±ï¸  30 seconds") set_timer "30s" "30 seconds" ;;
"â±ï¸  1 minute") set_timer "1m" "1 minute" ;;
"â±ï¸  2 minutes") set_timer "2m" "2 minutes" ;;
"â±ï¸  5 minutes") set_timer "5m" "5 minutes" ;;
"â±ï¸  10 minutes") set_timer "10m" "10 minutes" ;;
"â±ï¸  15 minutes") set_timer "15m" "15 minutes" ;;
"â±ï¸  20 minutes") set_timer "20m" "20 minutes" ;;
"ğŸ…  25 minutes (Pomodoro)") set_timer "25m" "25 minutes (Pomodoro)" ;;
"â±ï¸  30 minutes") set_timer "30m" "30 minutes" ;;
"â±ï¸  45 minutes") set_timer "45m" "45 minutes" ;;
"ğŸ•  1 hour") set_timer "1h" "1 hour" ;;
"ğŸ•  1 hour 30 minutes") set_timer "1h30m" "1 hour 30 minutes" ;;
"ğŸ•  2 hours") set_timer "2h" "2 hours" ;;
"ğŸ•  3 hours") set_timer "3h" "3 hours" ;;

# Till specific time presets
"ğŸ•  Till 00:00 (midnight)") set_timer_till "00:00" "00:00 (midnight)" ;;
"ğŸ•  Till 01:00 (1 AM)") set_timer_till "01:00" "01:00 (1 AM)" ;;
"ğŸ•  Till 02:00 (2 AM)") set_timer_till "02:00" "02:00 (2 AM)" ;;
"ğŸ•  Till 03:00 (3 AM)") set_timer_till "03:00" "03:00 (3 AM)" ;;
"ğŸ•  Till 04:00 (4 AM)") set_timer_till "04:00" "04:00 (4 AM)" ;;
"ğŸ•  Till 05:00 (5 AM)") set_timer_till "05:00" "05:00 (5 AM)" ;;
"ğŸ•  Till 06:00 (6 AM)") set_timer_till "06:00" "06:00 (6 AM)" ;;
"ğŸ•  Till 07:00 (7 AM)") set_timer_till "07:00" "07:00 (7 AM)" ;;
"ğŸ•  Till 08:00 (8 AM)") set_timer_till "08:00" "08:00 (8 AM)" ;;
"ğŸ•  Till 09:00 (9 AM)") set_timer_till "09:00" "09:00 (9 AM)" ;;
"ğŸ•  Till 10:00 (10 AM)") set_timer_till "10:00" "10:00 (10 AM)" ;;
"ğŸ•  Till 11:00 (11 AM)") set_timer_till "11:00" "11:00 (11 AM)" ;;
"ğŸ•  Till 12:00 (noon)") set_timer_till "12:00" "12:00 (noon)" ;;
"ğŸ•  Till 13:00 (1 PM)") set_timer_till "13:00" "13:00 (1 PM)" ;;
"ğŸ•  Till 14:00 (2 PM)") set_timer_till "14:00" "14:00 (2 PM)" ;;
"ğŸ•  Till 15:00 (3 PM)") set_timer_till "15:00" "15:00 (3 PM)" ;;
"ğŸ•  Till 16:00 (4 PM)") set_timer_till "16:00" "16:00 (4 PM)" ;;
"ğŸ•  Till 17:00 (5 PM)") set_timer_till "17:00" "17:00 (5 PM)" ;;
"ğŸ•  Till 18:00 (6 PM)") set_timer_till "18:00" "18:00 (6 PM)" ;;
"ğŸ•  Till 19:00 (7 PM)") set_timer_till "19:00" "19:00 (7 PM)" ;;
"ğŸ•  Till 20:00 (8 PM)") set_timer_till "20:00" "20:00 (8 PM)" ;;
"ğŸ•  Till 21:00 (9 PM)") set_timer_till "21:00" "21:00 (9 PM)" ;;
"ğŸ•  Till 22:00 (10 PM)") set_timer_till "22:00" "22:00 (10 PM)" ;;
"ğŸ•  Till 23:00 (11 PM)") set_timer_till "23:00" "23:00 (11 PM)" ;;

# Custom time input
"âŒ¨ï¸  Custom time...")
    custom=$(echo "" | rofi -dmenu -p "Enter time (e.g., 1h30m45s)" \
        -theme-str 'window {width: 450px;}' \
        -mesg "Examples: 1h30m, 90m, 45s, 2h15m30s" \
        $ROFI_THEME)

    if [[ -n "$custom" ]]; then
        if $TIMER_BIN --set "$custom" 2>/dev/null; then
            notify-send "â±ï¸ Timer" "Set to $custom" -t 2000
        else
            notify-send "âŒ Timer Error" "Invalid format: $custom" -u critical -t 3000
        fi
    fi
    ;;

# Custom till time input
"âŒ¨ï¸  Custom till time...")
    custom_time=$(echo "" | rofi -dmenu -p "Enter time (24-hour format)" \
        -theme-str 'window {width: 450px;}' \
        -mesg "Examples: 14:30, 09:00, 23:45" \
        $ROFI_THEME)

    if [[ -n "$custom_time" ]]; then
        if $TIMER_BIN --till "$custom_time" 2>/dev/null; then
            notify-send "â±ï¸ Timer" "Set until $custom_time" -t 2000
        else
            notify-send "âŒ Timer Error" "Invalid time format: $custom_time" -u critical -t 3000
        fi
    fi
    ;;

# Start/Stop controls
"â–¶ï¸  Start timer")
    $TIMER_BIN --exec-start 2>/dev/null
    notify-send "â–¶ï¸ Timer" "Started" -t 2000
    ;;

"â¹ï¸  Stop timer")
    $TIMER_BIN --exec-stop 2>/dev/null
    notify-send "â¹ï¸ Timer" "Stopped and reset" -t 2000
    ;;

"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
    # Separator selected, do nothing
    ;;
esac
