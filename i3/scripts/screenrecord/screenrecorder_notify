#!/bin/bash
# Simple notification indicator

NOTIFICATION_ID=9999
PID_FILE="/tmp/screenrecord_pid_${USER}"

is_recording() {
  [[ -f "$PID_FILE" ]] && kill -0 $(cat "$PID_FILE" 2>/dev/null) 2>/dev/null
}

get_time() {
  if [[ -f "$PID_FILE" ]]; then
    pid=$(cat "$PID_FILE")
    start_time=$(ps -o lstart= -p "$pid" 2>/dev/null | head -n1)
    
    if [[ -n "$start_time" ]]; then
      start_epoch=$(date -d "$start_time" +%s 2>/dev/null)
      current_epoch=$(date +%s)
      
      if [[ -n "$start_epoch" ]]; then
        duration=$((current_epoch - start_epoch))
        minutes=$((duration / 60))
        seconds=$((duration % 60))
        printf "%02d:%02d" $minutes $seconds
        return
      fi
    fi
  fi
  echo "00:00"
}

# Check for dunst
has_dunst() {
  pgrep -x dunst >/dev/null
}

if has_dunst; then
  # Update notification every second
  while is_recording; do
    time_str=$(get_time)
    notify-send -r $NOTIFICATION_ID -u low -t 1500 "ðŸ”´ Recording" "$time_str"
    sleep 1
  done
  
  notify-send -r $NOTIFICATION_ID -u normal -t 3000 "âœ… Recording Stopped" "Video saved"
else
  # Simple start/stop notifications
  notify-send -u low "ðŸ”´ Recording Started" "Screen recording in progress"
  
  while is_recording; do
    sleep 2
  done
  
  notify-send -u normal "âœ… Recording Stopped" "Video saved"
fi
